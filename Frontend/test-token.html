<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Token Test</title>
  </head>
  <body>
    <h1>Authentication Token Test</h1>

    <div id="token-status"></div>
    <div id="test-results"></div>

    <button onclick="testToken()">Test Token</button>
    <button onclick="clearToken()">Clear Token</button>

    <script>
      function checkToken() {
        const token = localStorage.getItem("token");
        const user = localStorage.getItem("user");

        const statusDiv = document.getElementById("token-status");

        if (token) {
          statusDiv.innerHTML = `
                    <h3>✅ Token Found</h3>
                    <p><strong>Token:</strong> ${token.substring(0, 20)}...</p>
                    <p><strong>User:</strong> ${
                      user ? JSON.parse(user).name : "Unknown"
                    }</p>
                `;
        } else {
          statusDiv.innerHTML = `
                    <h3>❌ No Token Found</h3>
                    <p>You need to log in first!</p>
                `;
        }
      }

      async function testToken() {
        const token = localStorage.getItem("token");
        if (!token) {
          alert("No token found! Please log in first.");
          return;
        }

        const resultsDiv = document.getElementById("test-results");
        resultsDiv.innerHTML = "<p>Testing token...</p>";

        try {
          // Test the health endpoint
          const healthResponse = await fetch(
            "http://localhost:5000/api/health"
          );
          const healthData = await healthResponse.json();

          // Test the AI health endpoint
          const aiResponse = await fetch(
            "http://localhost:5000/api/ai/health",
            {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );
          const aiData = await aiResponse.json();

          resultsDiv.innerHTML = `
                    <h3>✅ Token Test Results</h3>
                    <p><strong>Backend Health:</strong> ${
                      healthData.success ? "OK" : "Failed"
                    }</p>
                    <p><strong>AI Routes:</strong> ${
                      aiData.success ? "OK" : "Failed"
                    }</p>
                    <p><strong>Token Status:</strong> Valid ✅</p>
                `;
        } catch (error) {
          resultsDiv.innerHTML = `
                    <h3>❌ Token Test Failed</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>Your token might be expired or invalid.</p>
                `;
        }
      }

      function clearToken() {
        localStorage.removeItem("token");
        localStorage.removeItem("user");
        checkToken();
        document.getElementById("test-results").innerHTML = "";
      }

      // Check token on page load
      checkToken();
    </script>
  </body>
</html>
